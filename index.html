<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Son 30 - DominÃ³ Dominicano</title>
  <meta name="theme-color" content="#0ea5e9"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png"/>
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png"/>
  <link rel="apple-touch-icon" href="icon-192x192.png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html.dark { background: #18181b; }
    .fade-in { animation: fadeIn 0.7s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .celebrate { animation: pop 0.5s cubic-bezier(.36,1.01,.32,1.01) 2; }
    @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
  </style>
</head>
<body class="transition-colors duration-300">
  <div id="root"></div>
  <!-- Banner Adsterra (puedes pegar aquÃ­ tu cÃ³digo) -->
  <!--
  <div style="position:fixed;bottom:0;left:0;right:0;z-index:1000;background:#fff;padding:5px;text-align:center;box-shadow:0 -2px 10px rgba(0,0,0,0.1);">
    TU CÃ“DIGO DE ADSTERRA AQUÃ
  </div>
  -->
  <script type="text/babel">

const { useState, useEffect } = React;

function getInitialState() {
  const saved = localStorage.getItem('son30-state');
  if (saved) return JSON.parse(saved);
  return {
    players: ['', '', '', ''],
    scores: { team1: 0, team2: 0 },
    rounds: [],
    stats: { team1: 0, team2: 0 },
    target: 100,
    dark: window.matchMedia('(prefers-color-scheme: dark)').matches,
  };
}

function App() {
  const [players, setPlayers] = useState(getInitialState().players);
  const [scores, setScores] = useState(getInitialState().scores);
  const [rounds, setRounds] = useState(getInitialState().rounds);
  const [target, setTarget] = useState(getInitialState().target);
  const [stats, setStats] = useState(getInitialState().stats);
  const [gameState, setGameState] = useState('setup'); // setup, playing, finished
  const [winner, setWinner] = useState(null);
  const [celebration, setCelebration] = useState('');
  const [editNames, setEditNames] = useState(false);
  const [confirm, setConfirm] = useState(null);
  const [dark, setDark] = useState(getInitialState().dark);

  // Guardar en localStorage
  useEffect(() => {
    localStorage.setItem('son30-state', JSON.stringify({
      players, scores, rounds, stats, target, dark
    }));
    document.documentElement.classList.toggle('dark', dark);
  }, [players, scores, rounds, stats, target, dark]);

  // Detectar ganador
  useEffect(() => {
    if (scores.team1 >= target || scores.team2 >= target) {
      const win = scores.team1 >= target ? 'team1' : 'team2';
      setWinner(win);
      setGameState('finished');
      setCelebration('ğŸ† Â¡GANADORES! ğŸ†');
      setStats(s => ({ ...s, [win]: s[win] + 1 }));
      setTimeout(() => setCelebration(''), 2500);
    }
  }, [scores, target]);

  // Compartir resultado
  function shareResult() {
    const text = `Â¡GanÃ³ ${players[winner === 'team1' ? 0 : 2]} y ${players[winner === 'team1' ? 1 : 3]} en Son 30! Marcador final: ${scores.team1} - ${scores.team2}`;
    if (navigator.share) {
      navigator.share({ text });
    } else {
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
    }
  }

  // Reiniciar todo
  function resetAll() {
    setPlayers(['', '', '', '']);
    setScores({ team1: 0, team2: 0 });
    setRounds([]);
    setWinner(null);
    setGameState('setup');
    setCelebration('');
  }

  // Nueva partida (mantiene nombres y stats)
  function newGame() {
    setScores({ team1: 0, team2: 0 });
    setRounds([]);
    setWinner(null);
    setGameState('playing');
    setCelebration('');
  }

  // Sumar puntos
  function addPoints(team, points, type = 'normal') {
    if (gameState !== 'playing') return;
    const newScores = { ...scores, [team]: scores[team] + points };
    const newRound = {
      id: Date.now(),
      team,
      points,
      type,
      timestamp: new Date().toLocaleTimeString()
    };
    setScores(newScores);
    setRounds([...rounds, newRound]);
    if (type !== 'normal') {
      setCelebration(type === 'capicua' ? 'ğŸ‰ Â¡CapicÃºa! ğŸ‰' : 'ğŸš¶ Â¡Paso Corrido! ğŸš¶');
      setTimeout(() => setCelebration(''), 1800);
    }
  }

  // Deshacer Ãºltima ronda
  function undoLastRound() {
    if (!rounds.length) return;
    const last = rounds[rounds.length - 1];
    setScores(s => ({ ...s, [last.team]: s[last.team] - last.points }));
    setRounds(r => r.slice(0, -1));
    setWinner(null);
    setGameState('playing');
  }

  // Editar nombres
  function handleNameChange(i, val) {
    setPlayers(p => {
      const copy = [...p];
      copy[i] = val;
      return copy;
    });
  }

  // Cambiar puntaje objetivo
  function handleTargetChange(val) {
    let n = parseInt(val, 10);
    if (isNaN(n) || n < 30) n = 30;
    if (n > 300) n = 300;
    setTarget(n);
  }

  // Cambiar modo oscuro
  function toggleDark() {
    setDark(d => !d);
  }

  // Pantalla de setup
  if (gameState === 'setup') {
    return (
      <div className={`min-h-screen ${dark ? 'bg-gray-900 text-white' : 'bg-gradient-to-br from-sky-400 to-blue-600 text-gray-900'} flex items-center justify-center fade-in`}>
        <div className="w-full max-w-md bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-6">
          <h1 className="text-3xl font-extrabold text-center mb-2">ğŸ¯ Son 30</h1>
          <p className="text-center mb-6 text-gray-500 dark:text-gray-300">DominÃ³ Dominicano</p>
          <div className="mb-4">
            <label className="block font-semibold mb-1">Puntaje objetivo</label>
            <input type="number" min="30" max="300" value={target} onChange={e => handleTargetChange(e.target.value)}
              className="w-full p-2 rounded-lg border dark:bg-gray-700 dark:text-white"/>
          </div>
          <div className="mb-4">
            <label className="block font-semibold mb-1">Pareja 1</label>
            <input type="text" placeholder="Jugador 1" value={players[0]} onChange={e => handleNameChange(0, e.target.value)}
              className="w-full p-2 rounded-lg border mb-2 dark:bg-gray-700 dark:text-white"/>
            <input type="text" placeholder="Jugador 2" value={players[1]} onChange={e => handleNameChange(1, e.target.value)}
              className="w-full p-2 rounded-lg border dark:bg-gray-700 dark:text-white"/>
          </div>
          <div className="mb-4">
            <label className="block font-semibold mb-1">Pareja 2</label>
            <input type="text" placeholder="Jugador 3" value={players[2]} onChange={e => handleNameChange(2, e.target.value)}
              className="w-full p-2 rounded-lg border mb-2 dark:bg-gray-700 dark:text-white"/>
            <input type="text" placeholder="Jugador 4" value={players[3]} onChange={e => handleNameChange(3, e.target.value)}
              className="w-full p-2 rounded-lg border dark:bg-gray-700 dark:text-white"/>
          </div>
          <button
            className="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 rounded-xl text-lg transition-colors"
            disabled={!players.every(n => n.trim())}
            onClick={() => setGameState('playing')}
          >Comenzar Partida</button>
          <div className="mt-4 flex justify-between items-center">
            <button onClick={toggleDark} className="text-sm text-gray-400 hover:text-sky-500">
              {dark ? 'â˜€ï¸ Modo Claro' : 'ğŸŒ™ Modo Oscuro'}
            </button>
            <span className="text-xs text-gray-400">v2.0</span>
          </div>
        </div>
      </div>
    );
  }

  // Pantalla principal
  return (
    <div className={`min-h-screen pb-28 ${dark ? 'bg-gray-900 text-white' : 'bg-gradient-to-br from-green-300 to-blue-400 text-gray-900'} fade-in`}>
      {/* Header */}
      <div className="max-w-2xl mx-auto pt-4 px-2">
        <div className={`flex justify-between items-center mb-2`}>
          <h1 className="text-2xl font-extrabold">ğŸ¯ Son 30</h1>
          <button onClick={toggleDark} className="text-lg">{dark ? 'â˜€ï¸' : 'ğŸŒ™'}</button>
        </div>
        <div className="flex justify-between items-center mb-2">
          <button
            className="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-3 py-1 rounded-lg text-sm"
            onClick={() => setEditNames(e => !e)}
          >{editNames ? 'Listo' : 'Editar Nombres'}</button>
          <button
            className="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-3 py-1 rounded-lg text-sm"
            onClick={() => setConfirm('reset')}
          >Reiniciar Todo</button>
        </div>
      </div>

      {/* CelebraciÃ³n */}
      {celebration && (
        <div className="max-w-2xl mx-auto mb-2">
          <div className="bg-yellow-400 dark:bg-yellow-600 text-center p-4 rounded-xl mb-2 celebrate text-2xl font-bold shadow">{celebration}</div>
        </div>
      )}

      {/* Marcadores */}
      <div className="max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        {[0, 2].map((i, idx) => {
          const team = idx === 0 ? 'team1' : 'team2';
          const color = idx === 0 ? 'red' : 'blue';
          return (
            <div key={team} className={`rounded-2xl shadow-lg p-4 bg-${color}-100 dark:bg-${color}-900`}>
              <div className="flex justify-between items-center mb-2">
                <div className={`font-bold text-${color}-700 dark:text-${color}-200 text-lg`}>ğŸ‘¥ Pareja {idx + 1}</div>
                <div className="text-xs text-gray-500 dark:text-gray-300">Victorias: {stats[team]}</div>
              </div>
              <div className="mb-2">
                {editNames ? (
                  <>
                    <input type="text" value={players[i]} onChange={e => handleNameChange(i, e.target.value)}
                      className="w-full p-1 rounded mb-1 border dark:bg-gray-700 dark:text-white"/>
                    <input type="text" value={players[i+1]} onChange={e => handleNameChange(i+1, e.target.value)}
                      className="w-full p-1 rounded border dark:bg-gray-700 dark:text-white"/>
                  </>
                ) : (
                  <div className="text-base font-semibold">{players[i]} & {players[i+1]}</div>
                )}
              </div>
              <div className={`text-4xl font-extrabold text-${color}-600 dark:text-${color}-200 mb-2`}>{scores[team]}</div>
              {/* Barra de progreso */}
              <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2">
                <div
                  className={`h-3 rounded-full bg-gradient-to-r from-${color}-400 to-${color}-600`}
                  style={{ width: `${Math.min(100, Math.round((scores[team] / target) * 100))}%`, transition: 'width 0.5s' }}
                ></div>
              </div>
              {/* Botones de puntos */}
              {gameState === 'playing' && (
                <div className="grid grid-cols-3 gap-2 mt-2">
                  {[5, 10, 15, 20].map(p => (
                    <button key={p} onClick={() => addPoints(team, p)}
                      className={`bg-${color}-500 hover:bg-${color}-600 text-white p-2 rounded-lg font-bold transition-colors`}>+{p}</button>
                  ))}
                  <button onClick={() => addPoints(team, 30, 'capicua')}
                    className="col-span-3 bg-yellow-500 hover:bg-yellow-600 text-white p-2 rounded-lg font-bold mt-1">ğŸ¯ CapicÃºa (+30)</button>
                  <button onClick={() => addPoints(team, 30, 'paso')}
                    className="col-span-3 bg-orange-500 hover:bg-orange-600 text-white p-2 rounded-lg font-bold mt-1">ğŸš¶ Paso Corrido (+30)</button>
                </div>
              )}
            </div>
          );
        })}
      </div>

      {/* Controles */}
      <div className="max-w-2xl mx-auto flex flex-col md:flex-row gap-2 mb-4">
        <button
          onClick={() => setConfirm('undo')}
          className="flex-1 bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-xl font-bold"
          disabled={!rounds.length}
        >â†¶ Deshacer Ãšltima Ronda</button>
        <button
          onClick={newGame}
          className="flex-1 bg-green-500 hover:bg-green-600 text-white p-3 rounded-xl font-bold"
        >Nueva Partida</button>
      </div>

      {/* Historial */}
      {rounds.length > 0 && (
        <div className="max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg mb-4">
          <h3 className="font-bold text-gray-800 dark:text-gray-200 mb-3">ğŸ“‹ Historial de Rondas</h3>
          <div className="max-h-40 overflow-y-auto space-y-2">
            {rounds.slice().reverse().map((round) => (
              <div key={round.id} className="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded">
                <span className="font-medium">{round.team === 'team1' ? 'Pareja 1' : 'Pareja 2'}</span>
                <span className={`font-bold ${round.type !== 'normal' ? 'text-yellow-600 dark:text-yellow-300' : ''}`}>
                  +{round.points} {round.type !== 'normal' ? `(${round.type})` : ''}
                </span>
                <span className="text-sm text-gray-500 dark:text-gray-300">{round.timestamp}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Pantalla de ganador */}
      {gameState === 'finished' && winner && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 fade-in">
          <div className="bg-white dark:bg-gray-900 rounded-2xl p-8 text-center shadow-2xl">
            <div className="text-4xl mb-2 celebrate">ğŸ†</div>
            <h2 className="text-2xl font-bold mb-2">Â¡GanÃ³ {players[winner === 'team1' ? 0 : 2]} y {players[winner === 'team1' ? 1 : 3]}!</h2>
            <div className="mb-4 text-lg">Marcador final: <b>{scores.team1} - {scores.team2}</b></div>
            <button onClick={newGame} className="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-xl font-bold mr-2">Nueva Partida</button>
            <button onClick={shareResult} className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-xl font-bold">Compartir</button>
          </div>
        </div>
      )}

      {/* Confirmaciones */}
      {confirm && (
        <div className="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 fade-in">
          <div className="bg-white dark:bg-gray-900 rounded-xl p-6 text-center shadow-xl">
            <div className="mb-4 text-lg">
              {confirm === 'reset' ? 'Â¿Seguro que quieres reiniciar todo?' : 'Â¿Deshacer la Ãºltima ronda?'}
            </div>
            <button onClick={() => {
              if (confirm === 'reset') resetAll();
              if (confirm === 'undo') undoLastRound();
              setConfirm(null);
            }} className="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-xl font-bold mr-2">SÃ­</button>
            <button onClick={() => setConfirm(null)} className="bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-xl font-bold">No</button>
          </div>
        </div>
      )}

      {/* EstadÃ­sticas */}
      <div className="max-w-2xl mx-auto mt-4 text-center text-xs text-gray-500 dark:text-gray-400">
        <span>Victorias: {players[0]} y {players[1]}: {stats.team1} | {players[2]} y {players[3]}: {stats.team2}</span>
      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
</body>
</html>
